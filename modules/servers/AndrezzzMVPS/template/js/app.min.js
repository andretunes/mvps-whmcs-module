/**
 *	WHMCS Server Provisioning version 1.1
 *
 *	@package     WHMCS
 *	@copyright   Andrezzz
 *	@link        https://www.andrezzz.pt
 *	@author      Andr√© Antunes <andreantunes@andrezzz.pt>
 */

function $_(a){return document.getElementById(a)}function AndrezzzVPS_API(a,c=!0,b={}){AndrezzzVPS_Loading(!0),$.post(productURL+"&modop=custom&a=ClientAreaAPI&api="+a,b,function(d){if("success"===d.result){switch(a){case"IPv6":$_("ipv6").parentElement.innerHTML=d.data,d.data="IPv6 created: "+d.data;break;case"Graphs":$_("cpu-graph").innerHTML=d.cpu_img,$_("cpu-graph").classList.add("graphs"),$_("ram-graph").innerHTML=d.mem_img,$_("ram-graph").classList.add("graphs"),$_("disk-graph").innerHTML=d.disk_img,$_("disk-graph").classList.add("graphs"),$_("network-graph").innerHTML=d.net_img,$_("network-graph").classList.add("graphs");break;case"Reinstall":window.location.reload();break;case"List backups":let o=$_("backupTable").getElementsByTagName("tbody")[0];delete d.result,$("#backupTable tbody").find("tr").remove();for(let k=0;k<Object.keys(d).length;k++){let e=d[Object.keys(d)[k]],h=o.insertRow(),p=h.insertCell(0),q=h.insertCell(1),r=h.insertCell(2),i=h.insertCell(3),s=h.insertCell(4);p.innerHTML=new Date(e.date).toLocaleString(),q.innerHTML=""!==e.size?e.size:"0.00GB",r.innerHTML=e.type,"ok"===e.status?(i.innerHTML='<div class="badge bg-success">Completed</div>',s.innerHTML='<a href="#" onclick="AndrezzzVPS_API(\'Restore backup\', true, { backup: '+e.id+' });return false;"><i class="fas fa-history restore-icon text-secondary mr-2"></i></a> <a href="#" onclick="AndrezzzVPS_API(\'Delete backup\', true, { backup: '+e.id+' });return false;"><i class="fas fa-1x fa-times delete" aria-hidden="true"></i></a>'):"preparing"===e.status?i.innerHTML='<div class="badge bg-info">Preparing</div>':"creating"===e.status?i.innerHTML='<div class="badge bg-warning">Creating '+e.percentage+"%</div>":i.innerHTML='<div class="badge bg-danger">'+e.status+"</div>"}break;case"Create backup":case"Delete backup":AndrezzzVPS_API("List backups",!1);break;case"Get Firewall rules":let t=$_("firewallTable").getElementsByTagName("tbody")[0];delete d.result,$("#firewallTable tbody").find("tr:not(:last)").remove();for(let l=0;l<Object.keys(d).length;l++){let f=d[Object.keys(d)[l]],g=t.insertRow(1),u=g.insertCell(0),v=g.insertCell(1),w=g.insertCell(2),x=g.insertCell(3),y=g.insertCell(4),z=g.insertCell(5);u.innerHTML=f.action,v.innerHTML=f.port,w.innerHTML=f.protocol,x.innerHTML=f.source,y.innerHTML=f.note,z.innerHTML='<a href="#" onclick="AndrezzzVPS_API(\'Delete Firewall rule\', true, { rule_id: '+f.id+' });return false;"><i class="fas fa-1x fa-times delete" aria-hidden="true"></i></a>'}$("#firewallTable tbody").append($("#firewallTable tbody tr:first"));break;case"Add Firewall rules":case"Delete Firewall rule":case"Commit Firewall rules":AndrezzzVPS_API("Get Firewall rules",!1);break;case"ISO Images":let A=$_("isoID");delete d.result,$("#isoID").empty();for(let m=0;m<Object.keys(d).length;m++){let n=d[Object.keys(d)[m]],j=document.createElement("option");j.value=n.id,j.innerHTML=n.name,j.selected=""!==b.currentISO&&b.currentISO==n.name,A.appendChild(j)}}AndrezzzVPS_Loading(!1),c&&AndrezzzVPS_Alert("success","string"==typeof d.data?d.data:lang.moduleactionsuccess)}else AndrezzzVPS_Loading(!1),AndrezzzVPS_Alert("error","string"==typeof d.message?d.message:lang.moduleactionfailed)})}function AndrezzzVPS_VNC(){window.open(productURL+"&modop=custom&a=VNC","_blank","toolbar=0,location=0,menubar=0")}function AndrezzzVPS_ShowTooltip(a,b,c){$('<div id="tooltip">'+c+"</div>").css({position:"absolute",display:"none",top:b+20,left:a-20,border:"1px solid #CCCCCC",padding:"2px","background-color":"#EFEFEF","z-index":1e4,opacity:.8}).appendTo("body").fadeIn(200)}function AndrezzzVPS_MakeData(a){var c=new Date().getTime();i=0;var b=[];for(x in a)b.push([c+=1e3,a[x]]),i++;return b}function AndrezzzVPS_Loading(a){$_("loading").style.left=((document.body.clientWidth-$("#loading").width())/2).toString()+"px",a?$("#loading").show():$("#loading").hide()}function AndrezzzVPS_LiveResourceGraph(a,c,b,d,e){if($.plot($("#"+a),c,b),!("tooltip"in b)){var f=null;$("#"+a).bind("plothover",function(l,i,c){if($("#x").text(i.x.toFixed(2)),$("#y").text(i.y.toFixed(2)),c){if(f!=c.dataIndex){f=c.dataIndex,$("#tooltip").remove();var k=c.datapoint[0].toFixed(2),j=c.datapoint[1].toFixed(2),h="";if(e&&(h=nDate(k,"m/d H:i:s")),"ntw_plot"===a||"io_read_plot"===a||"io_write_plot"===a){var g,b=parseInt(j);b<=1024?g="B/s":b>1024&&b<=1048576?(b=(b/1024).toFixed(2),g="KB/s"):b>1048576&&b<=1073741824?(b=(b/1024/1024).toFixed(2),g="MB/s"):b>1073741824&&(b=(b/1024/1024/1024).toFixed(2),g="GB/s"),AndrezzzVPS_ShowTooltip(c.pageX,c.pageY,c.series.label+" "+b+" "+g+"&nbsp; at &nbsp;"+h)}else AndrezzzVPS_ShowTooltip(c.pageX,c.pageY,parseFloat(j)+" "+d+h)}}else $("#tooltip").remove(),f=null})}}function AndrezzzVPS_ChooseOS(a){var b=$_("newOS").value;"0"!==b&&((b=$('[data-os="'+b+'"]')[0]).classList.remove("SelectedOS"),$_(b.dataset.group+"-os").classList.remove("selected"),$_(b.dataset.group+"-version").innerText="SELECT VERSION"),$_("newOS").value=a.dataset.os,a.classList.add("SelectedOS"),$_(a.dataset.group+"-os").classList.add("selected"),$_(a.dataset.group+"-version").innerText=a.innerText}function AndrezzzVPS_ShowPassword(){let a=$_("vpsPassword"),b=$_("showPasswordIcon");"password"===a.type?(a.type="text",b.classList="fa-solid fa-eye-slash"):(a.type="password",b.classList="fa-solid fa-eye")}function AndrezzzVPS_Alert(a,b){let c=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3});c.fire({icon:a,title:b})}$(document).ready(function(){$("#pills-tab").scrollingTabs({enableSwiping:!0,bootstrapVersion:5,cssClassLeftArrow:"fa fa-arrow-left",cssClassRightArrow:"fa fa-arrow-right"});for(var f,c={series:{lines:{show:!0,lineWidth:.1,fill:!0}},xaxis:{show:!0,color:"white",mode:"time",tickSize:[1,"second"],tickFormatter:function(b,f){var a=new Date(b);if(a.getSeconds()%5!=0)return"";var c=10>a.getHours()?"0"+a.getHours():a.getHours(),d=10>a.getMinutes()?"0"+a.getMinutes():a.getMinutes(),e=10>a.getSeconds()?"0"+a.getSeconds():a.getSeconds();return c+":"+d+":"+e},axisLabel:" ",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial",axisLabelPadding:10},yaxis:{show:!1},grid:{borderWidth:0,borderColor:"#fff",hoverable:!0}},a=[],b=0;b<30;++b)a.push(.1);var d=[{label:"",data:AndrezzzVPS_MakeData(a),color:"#e51e88"}];function e(){if("true"!==$_("overview-tab").ariaSelected)return f=setTimeout(e,1e4);if(clearTimeout(f),f)$.get(productURL+"&modop=custom&a=ClientAreaAPI&api=Server%20Info",function(b){"success"===b.result?(b.ram_usage=b.ram_usage/1e9,b.ram_usage_view=b.ram_usage.toFixed(2),b.ram_percentage=(100*b.ram_usage/serverInfoInitial.package.ram).toFixed(),b.bandwidth_percentage=(100*b.bandwidth_usage/(1e3*serverInfoInitial.package.bandwidth)).toFixed(),$("#ramPercentBar").css("background",b.ram_percentage<=40?"#06d79c":b.ram_percentage<80?"orange":b.ram_percentage>=80?"red":"#ff0000"),$("#ramPercentBar").css("width",b.ram_percentage+"%"),$("#ramPercentBar").html(b.ram_percentage+" %"),$("#ramPercentBar").attr("tooltip",b.ram_percentage+" %"),$("#ramPercentVal").html(b.ram_usage_view+" / "+serverInfoInitial.package.ram+" GB"),$("#bandwidthPercentBar").css("background",b.bandwidth_percentage<=40?"#9c06d7":b.bandwidth_percentage<80?"orange":b.bandwidth_percentage>=80?"red":"#ff0000"),$("#bandwidthPercentBar").css("width",b.bandwidth_percentage+"%"),$("#bandwidthPercentBar").html(b.bandwidth_percentage+" %"),$("#bandwidthPercentBar").attr("tooltip",b.bandwidth_percentage+" %"),$("#bandwidthPercentVal").html(b.bandwidth_usage+" / "+1e3*serverInfoInitial.package.bandwidth+" GB"),b.cpu_usage=(100*b.cpu_usage).toFixed(0),a.shift(),a.push(parseFloat(b.cpu_usage)),AndrezzzVPS_LiveResourceGraph("cpuHistory",d=[{label:"",data:AndrezzzVPS_MakeData(a),color:"#3498DB"}],c,"%",!1),$(".used-cpu").html(b.cpu_usage+"%")):AndrezzzVPS_Alert("error","string"==typeof b.message?b.message:lang.moduleactionfailed)});else{let b=serverInfoInitial;b.ram_usage=b.ram_usage/1e9,b.ram_usage_view=b.ram_usage.toFixed(2),b.ram_percentage=(100*b.ram_usage/serverInfoInitial.package.ram).toFixed(),b.bandwidth_percentage=(100*b.bandwidth_usage/(1e3*serverInfoInitial.package.bandwidth)).toFixed(),$("#ramPercentBar").css("background",b.ram_percentage<=40?"#06d79c":b.ram_percentage<80?"orange":b.ram_percentage>=80?"red":"#ff0000"),$("#ramPercentBar").css("width",b.ram_percentage+"%"),$("#ramPercentBar").html(b.ram_percentage+" %"),$("#ramPercentBar").attr("tooltip",b.ram_percentage+" %"),$("#ramPercentVal").html(b.ram_usage_view+" / "+serverInfoInitial.package.ram+" GB"),$("#bandwidthPercentBar").css("background",b.bandwidth_percentage<=40?"#9c06d7":b.bandwidth_percentage<80?"orange":b.bandwidth_percentage>=80?"red":"#ff0000"),$("#bandwidthPercentBar").css("width",b.bandwidth_percentage+"%"),$("#bandwidthPercentBar").html(b.bandwidth_percentage+" %"),$("#bandwidthPercentBar").attr("tooltip",b.bandwidth_percentage+" %"),$("#bandwidthPercentVal").html(b.bandwidth_usage+" / "+1e3*serverInfoInitial.package.bandwidth+" GB"),b.cpu_usage=(100*b.cpu_usage).toFixed(0),a.shift(),a.push(parseFloat(b.cpu_usage)),AndrezzzVPS_LiveResourceGraph("cpuHistory",d=[{label:"",data:AndrezzzVPS_MakeData(a),color:"#3498DB"}],c,"%",!1),$(".used-cpu").html(b.cpu_usage+"%")}f=setTimeout(e,1e4)}$_("AndrezzzVPS").style.display="block",AndrezzzVPS_LiveResourceGraph("cpuHistory",d,c,"%",!1),e()})